<App Theme="Basic" ClearColor="#35240F">
    <iOS.StatusBarConfig Style="Light" />
    <DockPanel>
        <Style>
            <Text TextColor="#ffffff" />
            <TextInput PlaceholderColor="#ffffff80" TextColor="#ffffff" CaretColor="#ffffff" />
            <Button ux:Class="PooButton" IgnoreStyle="true" ClipToBounds="false" Margin="0,0,0,4" Padding="20,7,20,7" Name="self">
                <Fuse.BasicTheme.ButtonText ux:Name="buttonText" TextColor="#fff" Value="{Property self.Text}" TextAlignment="Center" />
                <Rectangle Layer="Background">
                    <SolidColor ux:Name="buttonBg" Color="#AB5A23"/>
                </Rectangle>
                <WhileDisabled>
                    <Change buttonBg.Color="#54310B" Duration="0.3" Easing="CircularIn"/>
                    <Change buttonText.TextColor="#ffffff80" Duration="0.3" Easing="CircularIn"/>
                </WhileDisabled>
            </Button>
        </Style>
        
        <JavaScript>
            var Observable = require("FuseJS/Observable");

            var username = Observable("");
            var password = Observable("");
            var errorMessage = Observable("");

            var areCredentialsValid = Observable(function() {
                return username.value != "" && password.value != "";
            });

            var loginButtonClick = function () {
                var body = { "username" : username.value, "password" : password.value };

                fetch("http://www.dumplog.co.uk/auth/appLogin", {  
                    method: 'post',
                    body: JSON.stringify(body),
                    headers: new Headers({
                        'Content-Type': 'application/json'
                    })
                })
                .then(function(response) { 
                    return response.json(); 
                })
                .then(function(responseObject) {
                    console.log(JSON.stringify(responseObject));
                    if(responseObject.success) {
                        errorMessage.value = "Success!";
                    } else {
                        errorMessage.value = "Error: " + responseObject.errorMessage;
                    }
                }).catch(function (err) {
                    debug_log('Error: ' + err);
                });
            }

            module.exports = {
                username: username,
                password: password,
                areCredentialsValid: areCredentialsValid,
                loginButtonClick: loginButtonClick,
                errorMessage: errorMessage
            };
        </JavaScript>

        <Grid Rows="1*,1*">
            <StackPanel Alignment="VerticalCenter">
                <Text Alignment="HorizontalCenter" FontSize="50">DumpLog</Text>
                <Text Alignment="HorizontalCenter" Opacity=".5">Track your bowel movements on the go.</Text>
            </StackPanel>
            <StackPanel Alignment="VerticalCenter" Margin="50,0,50,0">
                <TextInput PlaceholderText="username" Value="{username}" />
                <TextInput PlaceholderText="password" IsPassword="true" Value="{password}" />
                <PooButton Text="Login" IsEnabled="{areCredentialsValid}" Clicked="{loginButtonClick}" />
                <Text Alignment="HorizontalCenter" Opacity=".5" Value="{errorMessage}" />
            </StackPanel>
        </Grid>
    </DockPanel>
</App>